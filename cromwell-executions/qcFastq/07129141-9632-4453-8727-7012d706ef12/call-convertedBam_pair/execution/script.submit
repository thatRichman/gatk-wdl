#!/bin/bash
# make sure there is no preexisting Docker CID file
rm -f /media/spencer/lstorage/GATK/gatk-wdl/cromwell-executions/qcFastq/07129141-9632-4453-8727-7012d706ef12/call-convertedBam_pair/execution/docker_cid
# run as in the original configuration without --rm flag (will remove later)
docker run \
  --cidfile /media/spencer/lstorage/GATK/gatk-wdl/cromwell-executions/qcFastq/07129141-9632-4453-8727-7012d706ef12/call-convertedBam_pair/execution/docker_cid \
  -i \
   \
  --entrypoint /bin/bash \
  -v /media/spencer/lstorage/GATK/gatk-wdl/cromwell-executions/qcFastq/07129141-9632-4453-8727-7012d706ef12/call-convertedBam_pair:/cromwell-executions/qcFastq/07129141-9632-4453-8727-7012d706ef12/call-convertedBam_pair:delegated \
  broadinstitute/gatk@sha256:5c8ad33becf8541ede410de4c99b861ae13bbb0a2dfa7501dcd758be8fc3f36d /cromwell-executions/qcFastq/07129141-9632-4453-8727-7012d706ef12/call-convertedBam_pair/execution/script

# get the return code (working even if the container was detached)
rc=$(docker wait `cat /media/spencer/lstorage/GATK/gatk-wdl/cromwell-executions/qcFastq/07129141-9632-4453-8727-7012d706ef12/call-convertedBam_pair/execution/docker_cid`)

# remove the container after waiting
docker rm `cat /media/spencer/lstorage/GATK/gatk-wdl/cromwell-executions/qcFastq/07129141-9632-4453-8727-7012d706ef12/call-convertedBam_pair/execution/docker_cid`

# return exit code
exit $rc
